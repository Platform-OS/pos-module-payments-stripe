---
method: post
layout: null
---
{% liquid
  function valid_webhook = 'modules/payments_stripe/commands/webhooks/is_valid', webhook_path: '/payments/stripe/checkout_session_completed_webhook', context: context
  unless valid_webhook
    response_status 403
    break
  endunless

  assign requester = context.current_user
  unless requester
    assign requester = null | hash_merge: id: 'stipe_webhook_request'
  endunless

  function object = 'modules/payments_stripe/commands/webhooks/checkout_session_completed/call', post_params: context.post_params, requester: requester
  if object.valid
    echo object
  else
    response_status 500
    echo object
  endif
%}
