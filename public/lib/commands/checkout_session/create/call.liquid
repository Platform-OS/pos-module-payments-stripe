{% liquid
  function object = 'modules/payments_stripe/commands/checkout_session/create/build', object: object
  function object = 'modules/payments_stripe/commands/checkout_session/create/check', object: object
  if object.valid
    function object = 'modules/payments_stripe/commands/checkout_session/create/save', object: object
    function transaction = 'modules/payments/queries/transactions/find', id: object['external_id']
    assign input = null | hash_merge: payment_status: object.status
    function object = 'modules/payments/commands/transactions/update_status', object: input, transaction: transaction, requester_id: requester.id, request_payload: object.data
  endif
  return object
%}
