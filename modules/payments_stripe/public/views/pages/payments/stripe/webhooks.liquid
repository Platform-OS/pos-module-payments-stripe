---
method: post
layout: null
---
{% liquid
  function valid_webhook = 'modules/payments_stripe/commands/webhooks/is_valid', webhook_path: '/payments/stripe/webhooks', context: context
  if valid_webhook
    case context.params.type
    when 'charge.succeeded'
      function response = 'modules/payments_stripe/commands/webhooks/charge', params: context.params, host: context.location.host, request_url: context.location.url
    when 'charge.pending'
      function response = 'modules/payments_stripe/commands/webhooks/charge', params: context.params, host: context.location.host, request_url: context.location.url
    when 'checkout.session.expired'
      function response = 'modules/payments_stripe/commands/webhooks/session_expired', params: context.params, host: context.location.host, request_url: context.location.url
    when 'setup_intent.succeeded'
      function response = 'modules/payments_stripe/commands/webhooks/setup_intent', params: context.params, request_url: context.location.url, host: context.location.host
    endcase

    response_status response.status
    echo response.body
  else
    log context, type: 'ERROR: payments_stripe/checkout_session_completed_webhook invalid webhook'
    response_status 403
    break
  endif
%}
