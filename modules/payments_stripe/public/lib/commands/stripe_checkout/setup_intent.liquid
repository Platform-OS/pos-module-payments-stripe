{% liquid
  assign params = null | hash_merge: reference_id: reference_id, c__status: "app.statuses.setup_intents.new"
  function setup_intent = 'modules/payments_stripe/commands/setup_intents/create', object: params
  if setup_intent.valid
    function object = 'modules/payments_stripe/commands/stripe_checkout/setup_intent/build', object: object
    function object = 'modules/payments/commands/gateway_requests/send', object: object, name: 'payments_stripe_checkout_setup_intent', external_id: setup_intent.id, template: 'modules/payments_stripe/generic'
    function object = 'modules/payments_stripe/commands/stripe_checkout/setup_intent/map_response', object: object

    function setup_intent = 'modules/payments_stripe/commands/setup_intents/update_gateway_id', object: setup_intent, gateway_id: object.setup_intent
  endif

  return object
%}
